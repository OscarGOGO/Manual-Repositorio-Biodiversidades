<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 7 Loops en R. Paralelizar | Notas backend BiodiversidadES</title>
<meta name="author" content="Oscar Godínez Gómez">
<meta name="description" content="Existen diversas estrategias de paralelización y paquetes que ayudan a aplicarlos en R (e.g., parallel, foreach). En esta sección usaremos el paquete future que trata de simplificar la aplicación...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 7 Loops en R. Paralelizar | Notas backend BiodiversidadES">
<meta property="og:type" content="book">
<meta property="og:url" content="https://oscargogo.github.io/Libro_Prueba/loops-en-r.-paralelizar.html">
<meta property="og:image" content="https://oscargogo.github.io/Libro_Prueba/BiodiversidadES3.png">
<meta property="og:description" content="Existen diversas estrategias de paralelización y paquetes que ayudan a aplicarlos en R (e.g., parallel, foreach). En esta sección usaremos el paquete future que trata de simplificar la aplicación...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 7 Loops en R. Paralelizar | Notas backend BiodiversidadES">
<meta name="twitter:description" content="Existen diversas estrategias de paralelización y paquetes que ayudan a aplicarlos en R (e.g., parallel, foreach). En esta sección usaremos el paquete future que trata de simplificar la aplicación...">
<meta name="twitter:image" content="https://oscargogo.github.io/Libro_Prueba/BiodiversidadES3.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4/tabs.js"></script><script src="libs/bs3compat-0.2.4/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Notas backend BiodiversidadES</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Biodiversidades</a></li>
<li><a class="" href="git.html"><span class="header-section-number">1</span> Git</a></li>
<li><a class="" href="gitlab-github.html"><span class="header-section-number">2</span> GitLab GitHub</a></li>
<li><a class="" href="organizaci%C3%B3n-de-documentos-y-carpetas-en-el-repositorio.html"><span class="header-section-number">3</span> Organización de documentos y carpetas en el repositorio</a></li>
<li><a class="" href="organizaci%C3%B3n-de-documentos-y-carpetas-en-el-dico-duro-gap.html"><span class="header-section-number">4</span> Organización de documentos y carpetas en el dico duro $(\gap)</a></li>
<li><a class="" href="loops-en-r.-funciones-base-de-r.html"><span class="header-section-number">5</span> Loops en R. Funciones base de R</a></li>
<li><a class="" href="loops-en-r.-paquete-purrr.html"><span class="header-section-number">6</span> Loops en R. Paquete purrr</a></li>
<li><a class="active" href="loops-en-r.-paralelizar.html"><span class="header-section-number">7</span> Loops en R. Paralelizar</a></li>
<li><a class="" href="consultas-al-cat-usando-zacatuche-y-r.html"><span class="header-section-number">8</span> Consultas al CAT usando zacatuche y R</a></li>
<li><a class="" href="consulta-de-snib-registros-usando-zacatuche-y-r.html"><span class="header-section-number">9</span> Consulta de SNIB registros usando zacatuche y R</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/OscarGOGO/Libro_Prueba">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="loops-en-r.-paralelizar" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Loops en R. Paralelizar<a class="anchor" aria-label="anchor" href="#loops-en-r.-paralelizar"><i class="fas fa-link"></i></a>
</h1>
<p>Existen diversas estrategias de paralelización y paquetes que ayudan a aplicarlos en R (e.g., parallel, foreach). En esta sección usaremos el paquete <code>future</code> que trata de simplificar la aplicación de la paralelización en R para objetos de distintas clases. El paquete future tiene diversas estrategias de paralelización que pueden interactuar con la mayoría de las funciones y paquetes de R.</p>
<div class="inline-figure"><img src="images/future.png" width="300"></div>
<p>Entre las estrategias principales se encuentran las siguientes:</p>
<div class="inline-figure"><img src="images/future_2.png" width="547"></div>
<p>Las dos estrategias más populares son multicore y multiprocess, sin embargo, multicore solo está disponible para Linux.</p>
<p><strong>Secuencial</strong></p>
<div class="inline-figure"><img src="images/future_3.png" width="547"></div>
<p><strong>Multisession vs Multicore</strong></p>
<div class="inline-figure"><img src="images/future_4.PNG" width="547"></div>
<div id="multisession" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Multisession<a class="anchor" aria-label="anchor" href="#multisession"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Paso 0</strong>. Instalar y abrir el paquete future</p>
<pre><code>#&gt; 
#&gt; Attaching package: 'magrittr'
#&gt; The following object is masked from 'package:purrr':
#&gt; 
#&gt;     set_names</code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"future"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org">future</a></span><span class="op">)</span></span></code></pre></div>
<p><strong>Paso 1</strong>. Determinar cuántos cores o workers están disponibles, en este ejemplo usaremos la función nativa del paquete <strong>future</strong> llamada <code><a href="https://parallelly.futureverse.org/reference/availableCores.html">availableCores()</a></code>:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://parallelly.futureverse.org/reference/availableCores.html">availableCores</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; system </span></span>
<span><span class="co">#&gt;      8</span></span>
<span></span>
<span><span class="fu"><a href="https://parallelly.futureverse.org/reference/availableCores.html">availableCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span><span class="co">#&gt; system </span></span>
<span><span class="co">#&gt;      4</span></span>
<span><span class="fu"><a href="https://parallelly.futureverse.org/reference/availableCores.html">availableCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span></span>
<span><span class="co">#&gt; system </span></span>
<span><span class="co">#&gt;      6</span></span></code></pre></div>
<p><strong>Paso 2</strong>. Correr la estrategia multisesssion usando la función <code><a href="https://future.futureverse.org/reference/plan.html">plan()</a></code></p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="va">multisession</span>, gc <span class="op">=</span> <span class="cn">TRUE</span>, workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><strong>Paso 3</strong>. Cerrar el multisession</p>
<p>Opción 1</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span></span></code></pre></div>
<p>Opción 2</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">ps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ps/man/ps.html">ps</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">a</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span><span class="st">"Rscript.exe"</span><span class="op">)</span>,<span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">a</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/pskill.html">pskill</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div id="paquete-furrr" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Paquete furrr<a class="anchor" aria-label="anchor" href="#paquete-furrr"><i class="fas fa-link"></i></a>
</h2>
<p>Seguiremos usando el conjunto de datos llamado <strong>iris</strong>:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-819118464c331f080082" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-819118464c331f080082">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150"],[5.1,4.9,4.7,4.6,5,5.4,4.6,5,4.4,4.9,5.4,4.8,4.8,4.3,5.8,5.7,5.4,5.1,5.7,5.1,5.4,5.1,4.6,5.1,4.8,5,5,5.2,5.2,4.7,4.8,5.4,5.2,5.5,4.9,5,5.5,4.9,4.4,5.1,5,4.5,4.4,5,5.1,4.8,5.1,4.6,5.3,5,7,6.4,6.9,5.5,6.5,5.7,6.3,4.9,6.6,5.2,5,5.9,6,6.1,5.6,6.7,5.6,5.8,6.2,5.6,5.9,6.1,6.3,6.1,6.4,6.6,6.8,6.7,6,5.7,5.5,5.5,5.8,6,5.4,6,6.7,6.3,5.6,5.5,5.5,6.1,5.8,5,5.6,5.7,5.7,6.2,5.1,5.7,6.3,5.8,7.1,6.3,6.5,7.6,4.9,7.3,6.7,7.2,6.5,6.4,6.8,5.7,5.8,6.4,6.5,7.7,7.7,6,6.9,5.6,7.7,6.3,6.7,7.2,6.2,6.1,6.4,7.2,7.4,7.9,6.4,6.3,6.1,7.7,6.3,6.4,6,6.9,6.7,6.9,5.8,6.8,6.7,6.7,6.3,6.5,6.2,5.9],[3.5,3,3.2,3.1,3.6,3.9,3.4,3.4,2.9,3.1,3.7,3.4,3,3,4,4.4,3.9,3.5,3.8,3.8,3.4,3.7,3.6,3.3,3.4,3,3.4,3.5,3.4,3.2,3.1,3.4,4.1,4.2,3.1,3.2,3.5,3.6,3,3.4,3.5,2.3,3.2,3.5,3.8,3,3.8,3.2,3.7,3.3,3.2,3.2,3.1,2.3,2.8,2.8,3.3,2.4,2.9,2.7,2,3,2.2,2.9,2.9,3.1,3,2.7,2.2,2.5,3.2,2.8,2.5,2.8,2.9,3,2.8,3,2.9,2.6,2.4,2.4,2.7,2.7,3,3.4,3.1,2.3,3,2.5,2.6,3,2.6,2.3,2.7,3,2.9,2.9,2.5,2.8,3.3,2.7,3,2.9,3,3,2.5,2.9,2.5,3.6,3.2,2.7,3,2.5,2.8,3.2,3,3.8,2.6,2.2,3.2,2.8,2.8,2.7,3.3,3.2,2.8,3,2.8,3,2.8,3.8,2.8,2.8,2.6,3,3.4,3.1,3,3.1,3.1,3.1,2.7,3.2,3.3,3,2.5,3,3.4,3],[1.4,1.4,1.3,1.5,1.4,1.7,1.4,1.5,1.4,1.5,1.5,1.6,1.4,1.1,1.2,1.5,1.3,1.4,1.7,1.5,1.7,1.5,1,1.7,1.9,1.6,1.6,1.5,1.4,1.6,1.6,1.5,1.5,1.4,1.5,1.2,1.3,1.4,1.3,1.5,1.3,1.3,1.3,1.6,1.9,1.4,1.6,1.4,1.5,1.4,4.7,4.5,4.9,4,4.6,4.5,4.7,3.3,4.6,3.9,3.5,4.2,4,4.7,3.6,4.4,4.5,4.1,4.5,3.9,4.8,4,4.9,4.7,4.3,4.4,4.8,5,4.5,3.5,3.8,3.7,3.9,5.1,4.5,4.5,4.7,4.4,4.1,4,4.4,4.6,4,3.3,4.2,4.2,4.2,4.3,3,4.1,6,5.1,5.9,5.6,5.8,6.6,4.5,6.3,5.8,6.1,5.1,5.3,5.5,5,5.1,5.3,5.5,6.7,6.9,5,5.7,4.9,6.7,4.9,5.7,6,4.8,4.9,5.6,5.8,6.1,6.4,5.6,5.1,5.6,6.1,5.6,5.5,4.8,5.4,5.6,5.1,5.1,5.9,5.7,5.2,5,5.2,5.4,5.1],[0.2,0.2,0.2,0.2,0.2,0.4,0.3,0.2,0.2,0.1,0.2,0.2,0.1,0.1,0.2,0.4,0.4,0.3,0.3,0.3,0.2,0.4,0.2,0.5,0.2,0.2,0.4,0.2,0.2,0.2,0.2,0.4,0.1,0.2,0.2,0.2,0.2,0.1,0.2,0.2,0.3,0.3,0.2,0.6,0.4,0.3,0.2,0.2,0.2,0.2,1.4,1.5,1.5,1.3,1.5,1.3,1.6,1,1.3,1.4,1,1.5,1,1.4,1.3,1.4,1.5,1,1.5,1.1,1.8,1.3,1.5,1.2,1.3,1.4,1.4,1.7,1.5,1,1.1,1,1.2,1.6,1.5,1.6,1.5,1.3,1.3,1.3,1.2,1.4,1.2,1,1.3,1.2,1.3,1.3,1.1,1.3,2.5,1.9,2.1,1.8,2.2,2.1,1.7,1.8,1.8,2.5,2,1.9,2.1,2,2.4,2.3,1.8,2.2,2.3,1.5,2.3,2,2,1.8,2.1,1.8,1.8,1.8,2.1,1.6,1.9,2,2.2,1.5,1.4,2.3,2.4,1.8,1.8,2.1,2.4,2.3,1.9,2.3,2.5,2.3,1.9,2,2.3,1.8],["setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Sepal.Length<\/th>\n      <th>Sepal.Width<\/th>\n      <th>Petal.Length<\/th>\n      <th>Petal.Width<\/th>\n      <th>Species<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="future_map" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> future_map()<a class="anchor" aria-label="anchor" href="#future_map"><i class="fas fa-link"></i></a>
</h2>
<p>La función <code>future_map</code> es el simil de <code>map</code>. La función permite realizar iteraciones sobre una <em>lista, array o vector</em> y devuelve siempre una lista. Esto tiene varias ventajas, por ejemplo, que puedes guardar cualquier clase de R.</p>
<div class="inline-figure"><img src="images/furrr_1.png" width="547"></div>
<div class="inline-figure"><img src="images/furrr_2.png" width="547"></div>
<p><strong>Abrimos future y furrr, y escogemos una estrategia de paralelización</strong></p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr">furrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org">future</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="va">multisession</span>, gc <span class="op">=</span> <span class="cn">TRUE</span>, workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><strong>Vector como iteración</strong></p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">entrada</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map</a></span><span class="op">(</span><span class="va">entrada</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x.1</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">x.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Especie"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, </span>
<span>           <span class="st">"MSepal.Length"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x.1</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span>,</span>
<span>           <span class="st">"SDSepal.Length"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x.1</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span>  </span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x.1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;             Especie       MSepal.Length      SDSepal.Length </span></span>
<span><span class="co">#&gt;            "setosa"             "5.006" "0.352489687213451" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;             Especie       MSepal.Length      SDSepal.Length </span></span>
<span><span class="co">#&gt;        "versicolor"             "5.936" "0.516171147063863" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;             Especie       MSepal.Length      SDSepal.Length </span></span>
<span><span class="co">#&gt;         "virginica"             "6.588" "0.635879593274432"</span></span></code></pre></div>
<p><strong>lista como iteración</strong></p>
<p>Imaginemos que previamente hice un proceso donde separé las filas de cada especie y las guardé por separado en una lista.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">entrada</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">entrada</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "setosa"     "versicolor" "virginica"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">entrada</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "list"</span></span></code></pre></div>
<p>Ahora la lista tiene tres data.frames con los datos de cada especie y la usaremos como entrada en la función <code><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map()</a></code>. La lista tiene 3 elementos por lo que hará 3 iteraciones. En la iteración 1 tomará el primer data.frame de la lista, en la iteración 2 el segundo data.frame de la lista y en la iteración 3 tomará el tercer data.frame de la lista.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ejemplo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map</a></span><span class="op">(</span><span class="va">entrada</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"Especie"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span>, </span>
<span>           <span class="st">"MSepal.Length"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span>,</span>
<span>           <span class="st">"SDSepal.Length"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x.1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ejemplo</span></span>
<span><span class="co">#&gt; $setosa</span></span>
<span><span class="co">#&gt;   Especie MSepal.Length SDSepal.Length</span></span>
<span><span class="co">#&gt; 1  setosa         5.006      0.3524897</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $versicolor</span></span>
<span><span class="co">#&gt;      Especie MSepal.Length SDSepal.Length</span></span>
<span><span class="co">#&gt; 1 versicolor         5.936      0.5161711</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $virginica</span></span>
<span><span class="co">#&gt;     Especie MSepal.Length SDSepal.Length</span></span>
<span><span class="co">#&gt; 1 virginica         6.588      0.6358796</span></span></code></pre></div>
<p><strong>Colapsar la lista</strong></p>
<p>Ya que la lista de salida tiene data.frames con columnas con el mismo nombre podemos colapsarlos en un único data.frame usando la función do.call() y rbind(), la ultima indica de que forma se puede colapsar la lista en este caso rbind indica que las apile por filas, de tal forma que las columnas se mantienen integras y lo único que incrementa son las filas.</p>
<div class="inline-figure"><img src="images/docall_rbind.PNG" width="547"></div>
<div class="inline-figure"><img src="images/docall_cbind.PNG" width="547"></div>
<p>Antes es importante quitar los NULL. En ocasiones cuando algo no ocurre como deseamos en lugar de dejar que falle el loop guardamos el resultado como un NULL, así sabemos que los NULL dentro de nuestra lista son errores. Por ejemplo, supongamos que no queremos tener información de setosa porque sabemos que la información es incorrecta, así que aplicaremos una iteración y cuando lleguemos a esa especie devolverá un NULL.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ejemplo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map</a></span><span class="op">(</span><span class="va">entrada</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span> <span class="op">==</span> <span class="st">"setosa"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">x.1</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">x.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"Especie"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span>, </span>
<span>           <span class="st">"MSepal.Length"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span>,</span>
<span>           <span class="st">"SDSepal.Length"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x.1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">ejemplo</span></span>
<span><span class="co">#&gt; $setosa</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $versicolor</span></span>
<span><span class="co">#&gt;      Especie MSepal.Length SDSepal.Length</span></span>
<span><span class="co">#&gt; 1 versicolor         5.936      0.5161711</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $virginica</span></span>
<span><span class="co">#&gt;     Especie MSepal.Length SDSepal.Length</span></span>
<span><span class="co">#&gt; 1 virginica         6.588      0.6358796</span></span></code></pre></div>
<p>Ahora antes de hacer un <code><a href="https://rdrr.io/r/base/do.call.html">do.call()</a></code> necesitamos quitar el elemento NULL de nuestra lista. En este ejemplo es sencillo porque tenemos solo tres elementos, pero imaginemos su importancia cuando tengamos docenas, cientos o miles de elementos en nuestra lista.</p>
<p>Para quitar los NULL podemos recurrir a las funciones base de R:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Negate</a></span><span class="op">(</span><span class="va">is.null</span><span class="op">)</span>, <span class="va">ejemplo</span><span class="op">)</span></span>
<span><span class="co">#&gt; $versicolor</span></span>
<span><span class="co">#&gt;      Especie MSepal.Length SDSepal.Length</span></span>
<span><span class="co">#&gt; 1 versicolor         5.936      0.5161711</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $virginica</span></span>
<span><span class="co">#&gt;     Especie MSepal.Length SDSepal.Length</span></span>
<span><span class="co">#&gt; 1 virginica         6.588      0.6358796</span></span></code></pre></div>
<p>O podemos usar la función <code>compact</code> de purrr</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html">compact</a></span><span class="op">(</span><span class="va">ejemplo</span><span class="op">)</span></span>
<span><span class="co">#&gt; $versicolor</span></span>
<span><span class="co">#&gt;      Especie MSepal.Length SDSepal.Length</span></span>
<span><span class="co">#&gt; 1 versicolor         5.936      0.5161711</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $virginica</span></span>
<span><span class="co">#&gt;     Especie MSepal.Length SDSepal.Length</span></span>
<span><span class="co">#&gt; 1 virginica         6.588      0.6358796</span></span></code></pre></div>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ejemplo</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html">compact</a></span><span class="op">(</span><span class="va">ejemplo</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">ejemplo</span><span class="op">)</span></span>
<span><span class="co">#&gt;               Especie MSepal.Length SDSepal.Length</span></span>
<span><span class="co">#&gt; versicolor versicolor         5.936      0.5161711</span></span>
<span><span class="co">#&gt; virginica   virginica         6.588      0.6358796</span></span></code></pre></div>
<p>También podríamos colapsar la lista por columnas usando la función cbind, de tal forma que la única fila que tenemos se queda integra y lo que cambia es el no. de columnas.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="va">ejemplo</span><span class="op">)</span></span>
<span><span class="co">#&gt;   versicolor.Especie versicolor.MSepal.Length</span></span>
<span><span class="co">#&gt; 1         versicolor                    5.936</span></span>
<span><span class="co">#&gt;   versicolor.SDSepal.Length virginica.Especie</span></span>
<span><span class="co">#&gt; 1                 0.5161711         virginica</span></span>
<span><span class="co">#&gt;   virginica.MSepal.Length virginica.SDSepal.Length</span></span>
<span><span class="co">#&gt; 1                   6.588                0.6358796</span></span></code></pre></div>
<p><strong>Cerrar la paralelización</strong></p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">ps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ps/man/ps.html">ps</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">a</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span><span class="st">"Rscript.exe"</span><span class="op">)</span>,<span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">a</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/pskill.html">pskill</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div id="map_dfr-y-map_dfc-1" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> map_dfr y map_dfc<a class="anchor" aria-label="anchor" href="#map_dfr-y-map_dfc-1"><i class="fas fa-link"></i></a>
</h2>
<p>Para ahorrarnos el paso de usar la función <code><a href="https://rdrr.io/r/base/do.call.html">do.call()</a></code> para colapsar las listas en un data.frame podemos usar las funciones <code><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_dfr()</a></code> y <code><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_dfc()</a></code>.</p>
<p>Es igual a la función future_map (i.e., tiene la misma estructura y trabaja con vectores, listas, arrays) pero la salida siempre es un <strong>data.frame</strong> lo que implica que en las instrucciones que aplicas en cada iteración el resultado siempre debe ser un <strong>data.frame</strong>. Si la salida es un vector numérico, un vector de caracteres, una lista, array u otra clase entonces te marcará un error.</p>
<p><strong>Abrimos future y furrr, y escogemos una estrategia de paralelización</strong></p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr">furrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org">future</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="va">multisession</span>, gc <span class="op">=</span> <span class="cn">TRUE</span>, workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div id="future_map_dfr" class="section level4" number="7.4.0.1">
<h4>
<span class="header-section-number">7.4.0.1</span> <strong>future_map_dfr()</strong><a class="anchor" aria-label="anchor" href="#future_map_dfr"><i class="fas fa-link"></i></a>
</h4>
<p>En nuestro ejemplo anterior, esta función sustituye el <code>do.call(rbind, ejemplo)</code>. <strong>Nota</strong>. Dejaremos setosa.</p>
<div class="inline-figure"><img src="images/map_dfr.PNG" width="200"></div>
<p><strong>Usando una lista</strong></p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_dfr</a></span><span class="op">(</span><span class="va">entrada</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"Especie"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span>, </span>
<span>           <span class="st">"MSepal.Length"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span>,</span>
<span>           <span class="st">"SDSepal.Length"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x.1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Especie MSepal.Length SDSepal.Length</span></span>
<span><span class="co">#&gt; 1     setosa         5.006      0.3524897</span></span>
<span><span class="co">#&gt; 2 versicolor         5.936      0.5161711</span></span>
<span><span class="co">#&gt; 3  virginica         6.588      0.6358796</span></span></code></pre></div>
<p><strong>Usando un vector</strong></p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_dfr</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x.1</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">x.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Especie"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, </span>
<span>           <span class="st">"MSepal.Length"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x.1</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span>,</span>
<span>           <span class="st">"SDSepal.Length"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x.1</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span>  </span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x.1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 x 3</span></span>
<span><span class="co">#&gt;   Especie    MSepal.Length SDSepal.Length   </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;         &lt;chr&gt;            </span></span>
<span><span class="co">#&gt; 1 setosa     5.006         0.352489687213451</span></span>
<span><span class="co">#&gt; 2 versicolor 5.936         0.516171147063863</span></span>
<span><span class="co">#&gt; 3 virginica  6.588         0.635879593274432</span></span></code></pre></div>
</div>
<div id="future_map_dfc" class="section level3" number="7.4.1">
<h3>
<span class="header-section-number">7.4.1</span> <strong>future_map_dfc()</strong><a class="anchor" aria-label="anchor" href="#future_map_dfc"><i class="fas fa-link"></i></a>
</h3>
<p>En nuestro ejemplo anterior, esta función sustituye el <code>do.call(cbind, ejemplo)</code>.</p>
<div class="inline-figure"><img src="images/map_dfc.PNG" width="200"></div>
<p><strong>Usando una lista</strong></p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_dfc</a></span><span class="op">(</span><span class="va">entrada</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"Especie"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span>, </span>
<span>           <span class="st">"MSepal.Length"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span>,</span>
<span>           <span class="st">"SDSepal.Length"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x.1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; New names:</span></span>
<span><span class="co">#&gt; * `Especie` -&gt; `Especie...1`</span></span>
<span><span class="co">#&gt; * `MSepal.Length` -&gt; `MSepal.Length...2`</span></span>
<span><span class="co">#&gt; * `SDSepal.Length` -&gt; `SDSepal.Length...3`</span></span>
<span><span class="co">#&gt; * `Especie` -&gt; `Especie...4`</span></span>
<span><span class="co">#&gt; * `MSepal.Length` -&gt; `MSepal.Length...5`</span></span>
<span><span class="co">#&gt; * `SDSepal.Length` -&gt; `SDSepal.Length...6`</span></span>
<span><span class="co">#&gt; * `Especie` -&gt; `Especie...7`</span></span>
<span><span class="co">#&gt; * `MSepal.Length` -&gt; `MSepal.Length...8`</span></span>
<span><span class="co">#&gt; * `SDSepal.Length` -&gt; `SDSepal.Length...9`</span></span>
<span><span class="co">#&gt;   Especie...1 MSepal.Length...2 SDSepal.Length...3</span></span>
<span><span class="co">#&gt; 1      setosa             5.006          0.3524897</span></span>
<span><span class="co">#&gt;   Especie...4 MSepal.Length...5 SDSepal.Length...6</span></span>
<span><span class="co">#&gt; 1  versicolor             5.936          0.5161711</span></span>
<span><span class="co">#&gt;   Especie...7 MSepal.Length...8 SDSepal.Length...9</span></span>
<span><span class="co">#&gt; 1   virginica             6.588          0.6358796</span></span></code></pre></div>
<p><strong>Usando un vector</strong></p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_dfc</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x.1</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">x.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Especie"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, </span>
<span>           <span class="st">"MSepal.Length"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x.1</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span>,</span>
<span>           <span class="st">"SDSepal.Length"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x.1</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span>  </span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x.1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; New names:</span></span>
<span><span class="co">#&gt; * `` -&gt; `...1`</span></span>
<span><span class="co">#&gt; * `` -&gt; `...2`</span></span>
<span><span class="co">#&gt; * `` -&gt; `...3`</span></span>
<span><span class="co">#&gt; # A tibble: 3 x 3</span></span>
<span><span class="co">#&gt;   ...1              ...2              ...3             </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;             &lt;chr&gt;             &lt;chr&gt;            </span></span>
<span><span class="co">#&gt; 1 setosa            versicolor        virginica        </span></span>
<span><span class="co">#&gt; 2 5.006             5.936             6.588            </span></span>
<span><span class="co">#&gt; 3 0.352489687213451 0.516171147063863 0.635879593274432</span></span></code></pre></div>
<p><strong>¿Y si tenemos NULL de salida o un error en el proceso?</strong></p>
</div>
</div>
<div id="future_map_dblfuture_-map_chr-y-future_map_lgl" class="section level2" number="7.5">
<h2>
<span class="header-section-number">7.5</span> future_map_dbl,future_ map_chr y future_map_lgl<a class="anchor" aria-label="anchor" href="#future_map_dblfuture_-map_chr-y-future_map_lgl"><i class="fas fa-link"></i></a>
</h2>
<p>Este grupo de funciones realiza iteraciones sobre una <em>lista, array o vector</em> y devuelve <strong>siempre un vector</strong> numérico (map_dbl), carácter (map_chr) o lógico (map_lgl).</p>
<div class="inline-figure"><img src="images/map_varios.PNG" width="200"></div>
<div id="future_map_dbl" class="section level3" number="7.5.1">
<h3>
<span class="header-section-number">7.5.1</span> <strong>future_map_dbl()</strong><a class="anchor" aria-label="anchor" href="#future_map_dbl"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_dbl</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x.1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 82.537565 16.343948 27.377383  1.575251</span></span></code></pre></div>
</div>
<div id="future_map_chr" class="section level3" number="7.5.2">
<h3>
<span class="header-section-number">7.5.2</span> <strong>future_map_chr()</strong><a class="anchor" aria-label="anchor" href="#future_map_chr"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_chr</a></span><span class="op">(</span><span class="va">entrada</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x.1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;       setosa   versicolor    virginica </span></span>
<span><span class="co">#&gt;     "setosa" "versicolor"  "virginica"</span></span></code></pre></div>
</div>
<div id="future_map_lgl" class="section level3" number="7.5.3">
<h3>
<span class="header-section-number">7.5.3</span> <strong>future_map_lgl()</strong><a class="anchor" aria-label="anchor" href="#future_map_lgl"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_lgl</a></span><span class="op">(</span><span class="va">entrada</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="st">"setosa"</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x.1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;     setosa versicolor  virginica </span></span>
<span><span class="co">#&gt;       TRUE      FALSE      FALSE</span></span></code></pre></div>
</div>
</div>
<div id="incluir-una-condicional-para-detectar-posibles-errores" class="section level2" number="7.6">
<h2>
<span class="header-section-number">7.6</span> Incluir una condicional para detectar posibles errores<a class="anchor" aria-label="anchor" href="#incluir-una-condicional-para-detectar-posibles-errores"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prueba</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_lgl</a></span><span class="op">(</span><span class="va">entrada</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="st">"setosa"</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html">inherits</a></span><span class="op">(</span><span class="va">x.1</span>, <span class="st">"error"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Si existe un error primero cierro los sub procesos</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">ps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ps/man/ps.html">ps</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">a</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span><span class="st">"Rscript.exe"</span><span class="op">)</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">a</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/pskill.html">pskill</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co">#Despues detengo el loop</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"oh error"</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x.1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">err</span><span class="op">)</span><span class="va">err</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html">inherits</a></span><span class="op">(</span><span class="va">prueba</span>, <span class="st">"error"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#Si es parte de una función sirve guardar un posible error con tryCatch</span></span>
<span>  <span class="co"># Si existe un error primero cierro los sub procesos</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">ps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ps/man/ps.html">ps</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">a</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span><span class="st">"Rscript.exe"</span><span class="op">)</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">a</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/pskill.html">pskill</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co">#Despues detengo el loop</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"oh error"</span><span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Cerrar la paralelización</strong></p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">ps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ps/man/ps.html">ps</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">a</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span><span class="st">"Rscript.exe"</span><span class="op">)</span>,<span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">a</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/pskill.html">pskill</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="loops-en-r.-paquete-purrr.html"><span class="header-section-number">6</span> Loops en R. Paquete purrr</a></div>
<div class="next"><a href="consultas-al-cat-usando-zacatuche-y-r.html"><span class="header-section-number">8</span> Consultas al CAT usando zacatuche y R</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#loops-en-r.-paralelizar"><span class="header-section-number">7</span> Loops en R. Paralelizar</a></li>
<li><a class="nav-link" href="#multisession"><span class="header-section-number">7.1</span> Multisession</a></li>
<li><a class="nav-link" href="#paquete-furrr"><span class="header-section-number">7.2</span> Paquete furrr</a></li>
<li><a class="nav-link" href="#future_map"><span class="header-section-number">7.3</span> future_map()</a></li>
<li>
<a class="nav-link" href="#map_dfr-y-map_dfc-1"><span class="header-section-number">7.4</span> map_dfr y map_dfc</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#future_map_dfc"><span class="header-section-number">7.4.1</span> future_map_dfc()</a></li></ul>
</li>
<li>
<a class="nav-link" href="#future_map_dblfuture_-map_chr-y-future_map_lgl"><span class="header-section-number">7.5</span> future_map_dbl,future_ map_chr y future_map_lgl</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#future_map_dbl"><span class="header-section-number">7.5.1</span> future_map_dbl()</a></li>
<li><a class="nav-link" href="#future_map_chr"><span class="header-section-number">7.5.2</span> future_map_chr()</a></li>
<li><a class="nav-link" href="#future_map_lgl"><span class="header-section-number">7.5.3</span> future_map_lgl()</a></li>
</ul>
</li>
<li><a class="nav-link" href="#incluir-una-condicional-para-detectar-posibles-errores"><span class="header-section-number">7.6</span> Incluir una condicional para detectar posibles errores</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/OscarGOGO/Libro_Prueba/blob/master/07-Loops_p3.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/OscarGOGO/Libro_Prueba/edit/master/07-Loops_p3.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Notas backend BiodiversidadES</strong>" was written by Oscar Godínez Gómez. It was last built on 2023-07-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
